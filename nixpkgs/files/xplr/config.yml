version: v0.4.4
node_types:
  directory:
    meta:
      icon: 
  file:
    meta:
      icon: 
  symlink:
    meta:
      icon: 
  mime_essence:
    text/plain:
      meta:
        icon: 
    text/csv:
      meta:
        icon: 
  extension:
    md:
      meta:
        icon: 
    lock:
      meta:
        icon: 
    rs:
      meta:
        icon: 
modes:
  builtin:
    default:
      key_bindings:
        on_key:
          ctrl-f:
            help: search with preview
            messages:
              - BashExec: |
                  PTH=$(cat "${XPLR_PIPE_DIRECTORY_NODES_OUT:?}" | awk -F / '{print $NF}' | fzf --preview "pistol {}")
                  if [ -d "$PTH" ]; then
                      echo "ChangeDirectory: $PWD/${PTH:?}" >> "${XPLR_PIPE_MSG_IN:?}"
                  elif [ -f "$PTH" ]; then
                      echo "FocusPath: $PWD/${PTH:?}" >> "${XPLR_PIPE_MSG_IN:?}"
                  fi
              - SwitchMode: default

          m:
            help: bookmark
            messages:
              - BashExecSilently: |
                  PTH="${XPLR_FOCUS_PATH:?}"
                  if echo "${PTH:?}" >> "${XPLR_SESSION_PATH:?}/bookmarks"; then
                    echo "LogSuccess: Bookmarked ${PTH:?}" >> "${XPLR_PIPE_MSG_IN:?}"
                  else
                    echo "LogError: Failed to bookmark ${PTH:?}" >> "${XPLR_PIPE_MSG_IN:?}"
                  fi
          '`':
            help: go to bookmark
            messages:
              - BashExec: |
                  PTH=$(cat "${XPLR_SESSION_PATH:?}/bookmarks" | fzf)
                  echo "FocusPath: ${PTH:?}" >> "${XPLR_PIPE_MSG_IN:?}"
          R:
            help: batch rename
            messages:
              - BashExec: |
                  SELECTION=$(cat "${XPLR_PIPE_SELECTION_OUT:?}")
                  NODES=${SELECTION:-$(cat "${XPLR_PIPE_DIRECTORY_NODES_OUT:?}")}
                  massren $NODES

          S:
            help: serve $PWD
            messages:
              - BashExec: |
                  ip addr
                  sfz --all --cors --no-ignore --bind 0.0.0.0 . &
                  read -p "[Enter when done]"
                  kill %1

          Q:
            help: share via QR code
            messages:
              - BashExec: |
                  qrcp --keep-alive $(cat "${XPLR_PIPE_RESULT_OUT:?}") &
                  read -p "[Enter when done]"
                  kill %1

          y:
            help: copy
            messages:
              - SwitchMode: copy

          p:
            help: paste
            messages:
              - BashExecSilently: |
                  FNAME=$(cat "${XPLR_SESSION_PATH:?}/clipboardfilename")
                  echo "SwitchMode: paste" >> "${XPLR_PIPE_MSG_IN:?}"
                  echo "BufferInput: $FNAME" >> "${XPLR_PIPE_MSG_IN:?}"

          D:
            help: disk usage
            messages:
              - BashExec:
                  diskonaut
              - ClearScreen

  custom:
    copy:
      key_bindings:
        on_key:
          y:
            help: copy focused file
            messages:
              - BashExecSilently: |
                  PTH="${XPLR_FOCUS_PATH:?}"
                  if [ -f "${PTH:?}" ] && xclip -sel clip < "${PTH:?}"; then
                    echo "$(basename ${PTH:?})" > "${XPLR_SESSION_PATH:?}/clipboardfilename"
                    echo "LogSuccess: copied to clipboard" >> "${XPLR_PIPE_MSG_IN:?}"
                  else
                    echo "LogError: failed to copy" >> "${XPLR_PIPE_MSG_IN:?}"
                  fi
              - ClearScreen
              - SwitchMode: default

    paste:
      key_bindings:
        on_key:
          esc:
            help: cancel
            messages:
              - SwitchMode: default
          backspace:
            help: clear
            messages:
              - BufferInput: ""
          enter:
            help: paste
            messages:
              - BashExecSilently: |
                  if xclip -o -sel clip > "${XPLR_INPUT_BUFFER:?}"; then
                    echo "LogSuccess: paste successful" >> "${XPLR_PIPE_MSG_IN:?}"
                    echo Explore >> "${XPLR_PIPE_MSG_IN:?}"
                  else
                    echo "LogError: failed to paste" >> "${XPLR_PIPE_MSG_IN:?}"
                  fi
              - SwitchMode: default
        default:
          messages:
            - BufferInputFromKey
