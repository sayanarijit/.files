version: v0.5.2
node_types:
  directory:
    meta:
      icon: 
  file:
    meta:
      icon: 
  symlink:
    meta:
      icon: 
modes:
  custom:
    paste.rs:
      name: paste.rs
      key_bindings:
        on_key:
          p:
            help: paste
            messages:
              - BashExec: |
                  PTH="$(basename ${XPLR_FOCUS_PATH:?})"
                  DEST="${XPLR_SESSION_PATH:?}/paste.rs.list"
                  curl --data-binary "@${PTH:?}" "https://paste.rs" | tee -a "${DEST:?}"
                  echo
                  read -p "[enter to continue]"
              - SwitchMode: default
          l:
            help: list
            messages:
              - BashExec: |
                  cat "${XPLR_SESSION_PATH:?}/paste.rs.list"
                  echo
                  read -p "[enter to continue]"
              - SwitchMode: default
          o:
            help: search and open
            messages:
              - BashExec: |
                  DEST="${XPLR_SESSION_PATH:?}/paste.rs.list"
                  URL=$(fzf --preview "curl -s {}" < "${DEST:?}")
                  if [ "$URL" ]; then
                    OPENER=$(which xdg-open)
                    ${OPENER:-open} "${URL:?}"
                  fi
              - SwitchMode: default
          d:
            help: search and delete
            messages:
              - BashExec: |
                  DEST="${XPLR_SESSION_PATH:?}/paste.rs.list"
                  URL=$(fzf --preview "curl -s {}" < "${DEST:?}")
                  if [ "$URL" ]; then
                    curl -X DELETE "${URL:?}"
                    sd "${URL:?}\n" "" "${DEST:?}"
                    echo
                    read -p "[enter to continue]"
                  fi
              - SwitchMode: default
        default:
          messages:
            - SwitchMode: default
    qrcp:
      name: qrcp
      key_bindings:
        on_key:
          s:
            help: send
            messages:
              - BashExec: |
                  qrcp send --keep-alive $(cat "${XPLR_PIPE_RESULT_OUT:?}")
              - SwitchMode: default
          r:
            help: receive
            messages:
              - BashExec: |
                  qrcp receive --keep-alive
              - SwitchMode: default
        default:
          messages:
            - SwitchMode: default
    copy:
      name: copy
      key_bindings:
        on_key:
          y:
            help: copy focused file
            messages:
              - BashExecSilently: |
                  xclip-copyfile $(cat "${XPLR_PIPE_RESULT_OUT:?}")
              - SwitchMode: default
        default:
          messages:
            - SwitchMode: default
  builtin:
    default:
      key_bindings:
        on_key:
          y:
            help: copy
            messages:
              - SwitchMode: copy
          p:
            help: paste
            messages:
              - BashExecSilently: |
                  xclip-pastefile > /dev/null && echo Explore >> "${XPLR_PIPE_MSG_IN:?}"
          P:
            help: paste.rs
            messages:
              - SwitchMode: paste.rs
          m:
            help: bookmark
            messages:
              - BashExecSilently: |
                  PTH="${XPLR_FOCUS_PATH:?}"
                  if echo "${PTH:?}" >> "${XPLR_SESSION_PATH:?}/bookmarks"; then
                    echo "LogSuccess: ${PTH:?} added to bookmarks" >> "${XPLR_PIPE_MSG_IN:?}"
                  else
                    echo "LogError: Failed to bookmark ${PTH:?}" >> "${XPLR_PIPE_MSG_IN:?}"
                  fi
          '`':
            help: go to bookmark
            messages:
              - BashExec: |
                  PTH=$(cat "${XPLR_SESSION_PATH:?}/bookmarks" | fzf --no-sort)
                  if [ "$PTH" ]; then
                    echo "FocusPath: ${PTH:?}" >> "${XPLR_PIPE_MSG_IN:?}"
                  fi
          ctrl-h:
            help: history
            messages:
              - BashExec: |
                  PTH=$(cat "${XPLR_PIPE_HISTORY_OUT:?}" | sort -u | fzf --no-sort)
                  if [ "$PTH" ]; then
                    echo "ChangeDirectory: ${PTH:?}" >> "${XPLR_PIPE_MSG_IN:?}"
                  fi
          R:
            help: batch rename
            messages:
              - BashExec: |
                  SELECTION=$(cat "${XPLR_PIPE_SELECTION_OUT:?}")
                  NODES=${SELECTION:-$(cat "${XPLR_PIPE_DIRECTORY_NODES_OUT:?}")}
                  if [ "$NODES" ]; then
                    mmv $NODES
                    echo Explore >> "${XPLR_PIPE_MSG_IN:?}"
                  fi
          Q:
            help: send/receive via QR
            messages:
              - SwitchMode: qrcp
          S:
            help: serve $PWD
            messages:
              - BashExec: |
                  IP=$(ip addr | grep -w inet | cut -d/ -f1 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | fzf --prompt 'Select IP > ')
                  echo "IP: ${IP:?}"
                  read -p "Port (default 5000): " PORT
                  echo
                  sfz --all --cors --no-ignore --bind ${IP:?} --port ${PORT:-5000} .
          D:
            help: disk usage
            messages:
              - BashExec:
                  dua i
              - ClearScreen
